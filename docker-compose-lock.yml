version: '3.8'

services:
  lock-node-1:
    build:
      context: ./distributed-lock-py
      dockerfile: Dockerfile

    command: >
      python main.py
      --id="node1"
      --raft_addr="lock-node-1:7000"
      --http_addr="0.0.0.0:8000"
      --peers="lock-node-1:7000,lock-node-2:7000,lock-node-3:7000"
      --peer_http_addrs="lock-node-1:8000,lock-node-2:8001,lock-node-3:8002"
    ports:
      - "8000:8000"
    networks:
      - lock_net

  lock-node-2:
    build:
      context: ./distributed-lock-py
      dockerfile: Dockerfile
    command: >
      python main.py
      --id="node2"
      --raft_addr="lock-node-2:7000"
      --http_addr="0.0.0.0:8001"
      --peers="lock-node-1:7000,lock-node-2:7000,lock-node-3:7000"
      --peer_http_addrs="lock-node-1:8000,lock-node-2:8001,lock-node-3:8002"
    ports:
      - "8001:8001"
    networks:
      - lock_net

  lock-node-3:
    build:
      context: ./distributed-lock-py
      dockerfile: Dockerfile
    command: >
      python main.py
      --id="node3"
      --raft_addr="lock-node-3:7000"
      --http_addr="0.0.0.0:8002"
      --peers="lock-node-1:7000,lock-node-2:7000,lock-node-3:7000"
      --peer_http_addrs="lock-node-1:8000,lock-node-2:8001,lock-node-3:8002"
    ports:
      - "8002:8002"
    networks:
      - lock_net

networks:
  lock_net:
    driver: bridge