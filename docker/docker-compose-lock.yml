version: '3.8'

services:
  lock-node-1:
    build:
      context: ./distributed-lock-py
      dockerfile: Dockerfile
    image: ${COMPOSE_PROJECT_NAME}-lock-node
    command: >
      python main.py
        --id="node1"
        --raft_addr="lock-node-1:${RAFT_PORT}"
        --http_addr="0.0.0.0:${HTTP_PORT_1}"
        --peers="${ALL_RAFT_PEERS}"
        --peer_http_addrs="${ALL_HTTP_PEERS}"
    ports:
      - "${HTTP_PORT_1}:${HTTP_PORT_1}"
    networks:
      - lock_net

  lock-node-2:
    build:
      context: ./distributed-lock-py
      dockerfile: Dockerfile
    image: ${COMPOSE_PROJECT_NAME}-lock-node
    command: >
      python main.py
        --id="node2"
        --raft_addr="lock-node-2:${RAFT_PORT}"
        --http_addr="0.0.0.0:${HTTP_PORT_2}"
        --peers="${ALL_RAFT_PEERS}"
        --peer_http_addrs="${ALL_HTTP_PEERS}"
    ports:
      - "${HTTP_PORT_2}:${HTTP_PORT_2}"
    networks:
      - lock_net

  lock-node-3:
    build:
      context: ./distributed-lock-py
      dockerfile: Dockerfile
    image: ${COMPOSE_PROJECT_NAME}-lock-node
    command: >
      python main.py
        --id="node3"
        --raft_addr="lock-node-3:${RAFT_PORT}"
        --http_addr="0.0.0.0:${HTTP_PORT_3}"
        --peers="${ALL_RAFT_PEERS}"
        --peer_http_addrs="${ALL_HTTP_PEERS}"
    ports:
      - "${HTTP_PORT_3}:${HTTP_PORT_3}"
    networks:
      - lock_net

networks:
  lock_net:
    driver: bridge